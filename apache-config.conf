<VirtualHost *:80>
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html

    <Directory /var/www/html>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # Enable mod_expires for caching headers
    <IfModule mod_expires.c>
        ExpiresActive On
        
        # Cache static assets for 1 year
        ExpiresByType text/css "access plus 1 year"
        ExpiresByType application/javascript "access plus 1 year"
        ExpiresByType image/png "access plus 1 year"
        ExpiresByType image/jpg "access plus 1 year"
        ExpiresByType image/jpeg "access plus 1 year"
        ExpiresByType image/gif "access plus 1 year"
        ExpiresByType image/webp "access plus 1 year"
        ExpiresByType image/svg+xml "access plus 1 year"
        ExpiresByType font/woff "access plus 1 year"
        ExpiresByType font/woff2 "access plus 1 year"
        ExpiresByType font/ttf "access plus 1 year"
        ExpiresByType font/eot "access plus 1 year"
        
        # Cache HTML pages for 1 hour
        ExpiresByType text/html "access plus 1 hour"
        
        # Cache XML/RSS feeds for 1 hour
        ExpiresByType application/rss+xml "access plus 1 hour"
        ExpiresByType application/xml "access plus 1 hour"
    </IfModule>

    # Enable mod_headers for additional caching headers
    <IfModule mod_headers.c>
        # Add Cache-Control headers
        <FilesMatch "\.(css|js|png|jpg|jpeg|gif|webp|svg|woff|woff2|ttf|eot)$">
            Header set Cache-Control "public, max-age=31536000"
        </FilesMatch>
        
        # Do not cache HTML for logged-in sessions; default to short cache for anonymous
        <FilesMatch "\.(html|htm)$">
            Header set Cache-Control "public, max-age=300"
        </FilesMatch>
        
        # Add ETag header
        Header set ETag "Apache"
        
        # Add custom headers for WordPress caching detection
        Header set X-Cache-Enabled "true"
        Header set X-Cache-Status "HIT"
        
        # Security headers
        Header always set X-Content-Type-Options "nosniff"
        Header always set X-Frame-Options "SAMEORIGIN"
        Header always set X-XSS-Protection "1; mode=block"
        Header always set Referrer-Policy "strict-origin-when-cross-origin"
        
        # Remove server signature
        Header unset Server
    </IfModule>

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>
